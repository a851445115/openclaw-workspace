#!/usr/bin/env python3
import argparse
import json
import os
import sys


SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
SCRIPT_LIB_DIR = os.path.join(SCRIPT_DIR, "lib")
if SCRIPT_LIB_DIR not in sys.path:
    sys.path.insert(0, SCRIPT_LIB_DIR)

import ops_metrics


def parse_args() -> argparse.Namespace:
    parser = argparse.ArgumentParser()
    parser.add_argument("--root", required=True)
    parser.add_argument("--days", type=int, default=7)
    return parser.parse_args()


def main() -> int:
    args = parse_args()
    report = ops_metrics.aggregate_metrics(args.root, days=int(args.days))
    print(
        json.dumps(
            {
                "ok": True,
                "root": args.root,
                "days": int(args.days),
                "report": report,
            },
            ensure_ascii=True,
        )
    )
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
